include:
  - project: "mrpelz/boilerplate"
    ref: main
    file: "/gitlab/.gitlab-ci.yml"

publish:container:
  extends: .publish:container
  trigger:
    strategy: depend
    include:
    - local: "/gitlab/.container.gitlab-ci.yml"

deploy:k8s:
  stage: deploy
  rules:
    - if: $CI_COMMIT_TAG =~ /^v\d+\.\d+\.\d+$/
      variables:
        VERSION_TAG: "latest"
    - if: $CI_COMMIT_TAG
      variables:
        VERSION_TAG: "pre-${CI_COMMIT_TAG_MESSAGE}"
  trigger:
    strategy: depend
    include:
    - local: "/k8s/.k8s.gitlab-ci.yml"
