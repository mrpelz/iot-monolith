include:
  - project: "mrpelz/boilerplate"
    ref: main
    file: "/gitlab/.gitlab-ci.yml"

deploy:k8s:donbot:
  stage: deploy
  rules:
    - if: $CI_COMMIT_TAG =~ /^v\d+\.\d+\.\d+$/
      when: on_success
    - if: $CI_COMMIT_TAG
      when: manual
  variables:
    KUBECONFIG: $KUBECONFIG_DONBOT
  trigger:
    strategy: depend
    include:
    - local: "/k8s/.k8s.gitlab-ci.yml"

deploy:k8s:fanny:
  stage: deploy
  rules:
    - if: $CI_COMMIT_TAG =~ /^v\d+\.\d+\.\d+$/
      when: never
    - if: $CI_COMMIT_TAG
      when: on_success
  variables:
    KUBECONFIG: $KUBECONFIG_FANNY
  trigger:
    strategy: depend
    include:
    - local: "/k8s/.k8s.gitlab-ci.yml"
